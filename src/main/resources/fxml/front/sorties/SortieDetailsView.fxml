<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>

<VBox xmlns="http://javafx.com/javafx/21"
    xmlns:fx="http://javafx.com/fxml/1"
    fx:id="root"
    fx:controller="controllers.front.sorties.SortieDetailsController"
    spacing="14"
    styleClass="sortieDetailsRoot"
    stylesheets="@/styles/sorties/sorties-details.css">

    <padding>
        <Insets top="14" right="14" bottom="18" left="14"/>
    </padding>

    <HBox alignment="CENTER_LEFT" spacing="12">
        <Button text="â† Retour" onAction="#goBack" styleClass="backLinkBtn"/>
        <Region HBox.hgrow="ALWAYS"/>

        <HBox spacing="10" alignment="CENTER_RIGHT">
            <Button text="Copier infos" onAction="#copyInfos" styleClass="ghostBtn"/>

            <Button fx:id="btnRequests" text="Demandes" onAction="#openRequests"
                    styleClass="ghostBtn" visible="false" managed="false"/>
                <StackPane alignment="CENTER">
                <Button fx:id="btnChat" text="ðŸ’¬ Chat" onAction="#openChat"
                    styleClass="primaryBtn" visible="false" managed="false"/>
                <Label fx:id="chatUnreadBadge" text=""
                       styleClass="chatUnreadBadge"
                       visible="false" managed="false" mouseTransparent="true"
                       StackPane.alignment="TOP_RIGHT"/>
                </StackPane>

            <!-- âœ… NOUVEAU -->
            <Button fx:id="btnParticiper" text="Participer" onAction="#participer"
                    styleClass="primaryBtn" visible="false" managed="false"/>

            <Button fx:id="btnEdit" text="Modifier" onAction="#edit"
                    styleClass="primaryBtn" visible="false" managed="false"/>
            <Button fx:id="btnDelete" text="Supprimer" onAction="#delete"
                    styleClass="dangerBtn" visible="false" managed="false"/>
        </HBox>
    </HBox>

    <ScrollPane fx:id="detailsScroll" fitToWidth="true" fitToHeight="true"
                hbarPolicy="NEVER" vbarPolicy="ALWAYS" styleClass="detailsScroll"
                VBox.vgrow="ALWAYS">
        <content>
            <VBox fx:id="contentBox" spacing="14" minWidth="0">

                <!-- HERO (responsive) -->
                <StackPane fx:id="heroBox" styleClass="detailsHero"
                           minHeight="340" prefHeight="340" maxHeight="340">
                    <ImageView fx:id="heroImage"
                               preserveRatio="true"
                               smooth="true"
                               cache="true"
                               styleClass="detailsHeroImg heroImage"/>

                    <VBox spacing="10" styleClass="heroGlass" StackPane.alignment="BOTTOM_LEFT" minWidth="0" maxWidth="720">
                        <Label fx:id="title" text="Titre" styleClass="detailsTitle" wrapText="true" minWidth="0"/>

                        <HBox spacing="10" alignment="CENTER_LEFT" styleClass="heroMeta">
                            <Label fx:id="chipStatut" text="OUVERTE" styleClass="statusChip status-ouverte"/>
                            <Label fx:id="chipActivite" text="ActivitÃ©" styleClass="badge"/>
                            <Label fx:id="dateText" text="ðŸ“… â€”" styleClass="detailsHint"/>
                        </HBox>
                    </VBox>
                </StackPane>

                <HBox fx:id="mainRow" spacing="14" alignment="TOP_LEFT" minWidth="0">

                    <VBox fx:id="leftCol" spacing="14" HBox.hgrow="ALWAYS" minWidth="0">

                        <VBox spacing="10" styleClass="detailsCard">
                            <Label text="Localisation" styleClass="detailsSectionTitle"/>
                            <Label fx:id="locationLine" text="ðŸ“ â€”" styleClass="detailsLine" wrapText="true"/>
                            <Label fx:id="meetingLine" text="ðŸ¤ â€”" styleClass="detailsLine" wrapText="true"/>
                        </VBox>

                        <VBox spacing="10" styleClass="detailsCard">
                            <Label text="Description" styleClass="detailsSectionTitle"/>
                            <Label fx:id="description" text="" styleClass="detailsDesc" wrapText="true"/>
                        </VBox>

                        <VBox spacing="10" styleClass="detailsCard">
                            <Label text="Questions" styleClass="detailsSectionTitle"/>
                            <Label fx:id="questionsEmpty" text="Aucune question."
                                   styleClass="detailsMuted" visible="false" managed="false"/>
                            <FlowPane fx:id="questionsPane" hgap="10" vgap="10" prefWrapLength="760"/>
                        </VBox>

                        <VBox spacing="10" styleClass="detailsCard">
                            <Label text="Participants acceptÃ©s" styleClass="detailsSectionTitle"/>
                            <Label fx:id="acceptedEmpty" text="Aucun participant acceptÃ©."
                                   styleClass="detailsMuted" visible="false" managed="false"/>
                            <FlowPane fx:id="acceptedPane" hgap="10" vgap="10" prefWrapLength="760"/>
                        </VBox>

                        <!-- Demandes (intÃ©grÃ© dans la page, pas de fenÃªtre sÃ©parÃ©e) -->
                        <VBox fx:id="pendingSection" spacing="10" styleClass="detailsCard" visible="false" managed="false">
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Demandes en attente" styleClass="detailsSectionTitle"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="RafraÃ®chir" onAction="#refreshPending" styleClass="ghostBtn"/>
                            </HBox>

                            <Label fx:id="pendingEmpty" text="Aucune demande en attente."
                                   styleClass="detailsMuted" visible="false" managed="false"/>

                            <VBox fx:id="pendingList" spacing="10"/>
                        </VBox>

                    </VBox>

                    <VBox fx:id="sideCol" spacing="14" prefWidth="360" minWidth="0" maxWidth="360">
                        <VBox spacing="12" styleClass="sideCard">
                            <Label text="RÃ©sumÃ©" styleClass="detailsSectionTitle"/>

                            <VBox spacing="10" styleClass="infoList">
                                <HBox spacing="10" alignment="CENTER_LEFT" styleClass="infoRow">
                                    <Label text="ðŸ—“" styleClass="infoIcon"/>
                                    <VBox spacing="2" HBox.hgrow="ALWAYS" minWidth="0">
                                        <Label text="Date" styleClass="infoK"/>
                                        <Label fx:id="infoDate" text="â€”" styleClass="infoV" wrapText="true" minWidth="0"/>
                                    </VBox>
                                </HBox>

                                <HBox spacing="10" alignment="CENTER_LEFT" styleClass="infoRow">
                                    <Label text="ðŸ’°" styleClass="infoIcon"/>
                                    <VBox spacing="2" HBox.hgrow="ALWAYS" minWidth="0">
                                        <Label text="Budget" styleClass="infoK"/>
                                        <Label fx:id="infoBudget" text="â€”" styleClass="infoV" wrapText="true" minWidth="0"/>
                                    </VBox>
                                </HBox>

                                <HBox spacing="10" alignment="CENTER_LEFT" styleClass="infoRow">
                                    <Label text="ðŸ‘¥" styleClass="infoIcon"/>
                                    <VBox spacing="2" HBox.hgrow="ALWAYS" minWidth="0">
                                        <Label text="Places" styleClass="infoK"/>
                                        <Label fx:id="infoPlaces" text="â€”" styleClass="infoV" wrapText="true" minWidth="0"/>
                                    </VBox>
                                </HBox>

                                <HBox spacing="10" alignment="CENTER_LEFT" styleClass="infoRow">
                                    <Label text="âœ…" styleClass="infoIcon"/>
                                    <VBox spacing="2" HBox.hgrow="ALWAYS" minWidth="0">
                                        <Label text="Statut" styleClass="infoK"/>
                                        <Label fx:id="infoStatut" text="â€”" styleClass="detailsStatusChip statusChip" wrapText="false" minWidth="0"/>
                                    </VBox>
                                </HBox>

                                <HBox spacing="10" alignment="CENTER_LEFT" styleClass="infoRow">
                                    <Label text="ðŸ‘¤" styleClass="infoIcon"/>
                                    <VBox spacing="2" HBox.hgrow="ALWAYS" minWidth="0">
                                        <Label text="Organisateur" styleClass="infoK"/>
                                        <Label fx:id="infoOrganisateur" text="â€”" styleClass="infoV" wrapText="true" minWidth="0"/>
                                    </VBox>
                                </HBox>
                            </VBox>
                        </VBox>
                    </VBox>

                </HBox>

            </VBox>
        </content>
    </ScrollPane>
</VBox>